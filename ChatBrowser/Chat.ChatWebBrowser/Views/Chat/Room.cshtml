@model int
@using Chat.Entities.POCOEntities;
<h1>@Chat.ChatWebBrowser.Controllers.ChatController.Rooms.GetValueOrDefault(Model)</h1>
<div class="row">
    <div class="col-12">
        <input type="text" placeholder="user" id="user" />
        <input type="text" placeholder="text" id="message"/>
        <button id="btnSend">
            Send
        </button>
    </div>
</div>
<div class="row">
    <div class="col-6">
        <div id="messages">
            @foreach(Message message in ViewBag.messages)
            {
                <div>
                    <b>@message.user.UserName says:</b>
                    @message.content
                </div>
            }
        </div>
    </div>
    <div class="col-6">
        <div id="notifications">
            
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/Chath").build();
    //var connection = $.hubConnection('/chat', {useDefaultPath: false});
    //var changesHub = connection.createHubProxy('changesHub');

    connection.start().then(
        () => {
            connection.invoke("AddToGroup","@Model")
        }
    ).catch((e) => {
        console.log("error es");
        console.error(e);
    });

    document.getElementById("btnSend").addEventListener("click",(event) => {
        
        console.log("btn Send");
        let room = "@Model";
        let user = document.getElementById("user").value;
        let message = document.getElementById("message").value;

        connection.invoke("SendMessage",room,user,message).catch(
            (error) => { console.error(error.toString()); }

        );

        document.getElementById("message").value = "";
        document.getElementById("message").focus();

        event.preventDefault();
        

    });

    connection.on("ReceiveMessage",(user,message) => {
        console.log("Reci");
        var message = "<div> <b>"+user+" says: </b> "+message+" </div> ";
        document.getElementById("messages").innerHTML = message + document.getElementById("messages").innerHTML;
    });
</script>